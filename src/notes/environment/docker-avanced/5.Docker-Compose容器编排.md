---
# å½“å‰é¡µé¢å†…å®¹æ ‡é¢˜
title: äº”ã€Docker-Composeå®¹å™¨ç¼–æ’
# åˆ†ç±»
category:
  - docker
# æ ‡ç­¾
tag: 
  - docker
  - äº‘åŸç”Ÿå¼€å‘
  - Devops
sticky: false
# æ˜¯å¦æ”¶è—åœ¨åšå®¢ä¸»é¢˜çš„æ–‡ç« åˆ—è¡¨ä¸­ï¼Œå½“å¡«å…¥æ•°å­—æ—¶ï¼Œæ•°å­—è¶Šå¤§ï¼Œæ’åè¶Šé å‰ã€‚
star: false
# æ˜¯å¦å°†è¯¥æ–‡ç« æ·»åŠ è‡³æ–‡ç« åˆ—è¡¨ä¸­
article: true
# æ˜¯å¦å°†è¯¥æ–‡ç« æ·»åŠ è‡³æ—¶é—´çº¿ä¸­
timeline: true
---

## ä¸€ã€æ˜¯ä»€ä¹ˆ

Compose æ˜¯ Docker å…¬å¸æ¨å‡ºçš„ä¸€ä¸ªå·¥å…·è½¯ä»¶ï¼Œå¯ä»¥ç®¡ç†å¤šä¸ª Docker å®¹å™¨ç»„æˆä¸€ä¸ªåº”ç”¨ã€‚ä½ éœ€è¦å®šä¹‰ä¸€ä¸ª YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶docker-compose.ymlï¼Œ`å†™å¥½å¤šä¸ªå®¹å™¨ä¹‹é—´çš„è°ƒç”¨å…³ç³»`ã€‚ç„¶åï¼Œåªè¦ä¸€ä¸ªå‘½ä»¤ï¼Œå°±èƒ½åŒæ—¶å¯åŠ¨/å…³é—­è¿™äº›å®¹å™¨

Docker-Composeæ˜¯Dockerå®˜æ–¹å¼€æºé¡¹ç›®ï¼Œè´Ÿè´£å®ç°å¯¹Dockerå®¹å™¨é›†ç¾¤çš„å¿«é€Ÿç¼–æ’ã€‚

## äºŒã€èƒ½å¹²å˜›

 dockerå»ºè®®æˆ‘ä»¬æ¯ä¸€ä¸ªå®¹å™¨ä¸­åªè¿è¡Œä¸€ä¸ªæœåŠ¡,å› ä¸ºdockerå®¹å™¨æœ¬èº«å ç”¨èµ„æºæå°‘,æ‰€ä»¥æœ€å¥½æ˜¯å°†æ¯ä¸ªæœåŠ¡å•ç‹¬çš„åˆ†å‰²å¼€æ¥ä½†æ˜¯è¿™æ ·æˆ‘ä»¬åˆé¢ä¸´äº†ä¸€ä¸ªé—®é¢˜ï¼Ÿ

å¦‚æœæˆ‘éœ€è¦åŒæ—¶éƒ¨ç½²å¥½å¤šä¸ªæœåŠ¡,éš¾é“è¦æ¯ä¸ªæœåŠ¡å•ç‹¬å†™Dockerfileç„¶ååœ¨æ„å»ºé•œåƒ,æ„å»ºå®¹å™¨,è¿™æ ·ç´¯éƒ½ç´¯æ­»äº†,æ‰€ä»¥dockerå®˜æ–¹ç»™æˆ‘ä»¬æä¾›äº†docker-composeå¤šæœåŠ¡éƒ¨ç½²çš„å·¥å…·

ä¾‹å¦‚è¦å®ç°ä¸€ä¸ªWebå¾®æœåŠ¡é¡¹ç›®ï¼Œé™¤äº†WebæœåŠ¡å®¹å™¨æœ¬èº«ï¼Œå¾€å¾€è¿˜éœ€è¦å†åŠ ä¸Šåç«¯çš„æ•°æ®åº“mysqlæœåŠ¡å®¹å™¨ï¼ŒredisæœåŠ¡å™¨ï¼Œæ³¨å†Œä¸­å¿ƒeurekaï¼Œç”šè‡³è¿˜åŒ…æ‹¬è´Ÿè½½å‡è¡¡å®¹å™¨ç­‰ç­‰ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚

Composeå…è®¸ç”¨æˆ·é€šè¿‡ä¸€ä¸ªå•ç‹¬çš„**docker-compose.ymlæ¨¡æ¿æ–‡ä»¶**ï¼ˆYAML æ ¼å¼ï¼‰`æ¥å®šä¹‰ä¸€ç»„ç›¸å…³è”çš„åº”ç”¨å®¹å™¨ä¸ºä¸€ä¸ªé¡¹ç›®ï¼ˆprojectï¼‰ã€‚`

å¯ä»¥å¾ˆå®¹æ˜“åœ°ç”¨ä¸€ä¸ªé…ç½®æ–‡ä»¶å®šä¹‰ä¸€ä¸ªå¤šå®¹å™¨çš„åº”ç”¨ï¼Œç„¶åä½¿ç”¨ä¸€æ¡æŒ‡ä»¤å®‰è£…è¿™ä¸ªåº”ç”¨çš„æ‰€æœ‰ä¾èµ–ï¼Œå®Œæˆæ„å»ºã€‚Docker-Compose è§£å†³äº†å®¹å™¨ä¸å®¹å™¨ä¹‹é—´å¦‚ä½•ç®¡ç†ç¼–æ’çš„é—®é¢˜ã€‚

## ä¸‰ã€å»å“ªä¸‹

[å®˜ç½‘](https://docs.docker.com/compose/compose-file/compose-file-v3)

[å®˜ç½‘ä¸‹è½½](https://docs.docker.com/compose/install/)

>   å®‰è£…æ­¥éª¤

```shell
curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose

chmod +x /usr/local/bin/docker-compose

docker-compose --version
```

![image-20230522180130218](./images/image-20230522180130218.png)

>   å¸è½½æ­¥éª¤

![image-20230522180148038](./images/image-20230522180148038.png)

```shell
sudo rm /usr/local/bin/docker-compose
```

## å››ã€Composeæ ¸å¿ƒæ¦‚å¿µ

>   ä¸€æ–‡ä»¶

`docker-compose.yml`

>   ä¸¤è¦ç´ 

-   æœåŠ¡ï¼ˆserviceï¼‰

ä¸€ä¸ªä¸ªåº”ç”¨å®¹å™¨å®ä¾‹ï¼Œæ¯”å¦‚è®¢å•å¾®æœåŠ¡ã€åº“å­˜å¾®æœåŠ¡ã€mysqlå®¹å™¨ã€nginxå®¹å™¨æˆ–è€…rediså®¹å™¨

-   å·¥ç¨‹ï¼ˆprojectï¼‰

ç”±ä¸€ç»„å…³è”çš„åº”ç”¨å®¹å™¨ç»„æˆçš„ä¸€ä¸ª`å®Œæ•´ä¸šåŠ¡å•å…ƒ`ï¼Œåœ¨docker-compose.ymlæ–‡ä»¶ä¸­å®šä¹‰ã€‚

## äº”ã€Composeä½¿ç”¨çš„ä¸‰ä¸ªæ­¥éª¤

1.  ç¼–å†™Dockerfileå®šä¹‰å„ä¸ªå¾®æœåŠ¡åº”ç”¨å¹¶æ„å»ºå‡ºå¯¹åº”çš„é•œåƒæ–‡ä»¶ã€‚
2.  ä½¿ç”¨docker-compose.ymlå®šä¹‰ä¸€ä¸ªå®Œæ•´ä¸šåŠ¡å•å…ƒï¼Œå®‰æ’å¥½æ•´ä½“åº”ç”¨ä¸­çš„å„ä¸ªå®¹å™¨æœåŠ¡ã€‚
3.  æœ€åï¼Œæ‰§è¡Œdocker-compose upå‘½ä»¤æ¥å¯åŠ¨å¹¶è¿è¡Œæ•´ä¸ªåº”ç”¨ç¨‹åºï¼Œå®Œæˆä¸€é”®éƒ¨ç½²ä¸Šçº¿ã€‚

## å…­ã€Composeå¸¸ç”¨å‘½ä»¤

```shell
# Composeå¸¸ç”¨å‘½ä»¤

docker-compose -h                           # æŸ¥çœ‹å¸®åŠ©
docker-compose up                           # å¯åŠ¨æ‰€æœ‰docker-composeæœåŠ¡
docker-compose up -d                        # å¯åŠ¨æ‰€æœ‰docker-composeæœåŠ¡å¹¶åå°è¿è¡Œ
docker-compose down                         # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ã€ç½‘ç»œã€å·ã€é•œåƒã€‚
docker-compose exec  ymlé‡Œé¢çš„æœåŠ¡id                 # è¿›å…¥å®¹å™¨å®ä¾‹å†…éƒ¨  docker-compose exec docker-compose.ymlæ–‡ä»¶ä¸­å†™çš„æœåŠ¡id /bin/bash
docker-compose ps                      # å±•ç¤ºå½“å‰docker-composeç¼–æ’è¿‡çš„è¿è¡Œçš„æ‰€æœ‰å®¹å™¨
docker-compose top                     # å±•ç¤ºå½“å‰docker-composeç¼–æ’è¿‡çš„å®¹å™¨è¿›ç¨‹

docker-compose logs  ymlé‡Œé¢çš„æœåŠ¡id     # æŸ¥çœ‹å®¹å™¨è¾“å‡ºæ—¥å¿—
docker-compose config     # æ£€æŸ¥é…ç½®
docker-compose config -q  # æ£€æŸ¥é…ç½®ï¼Œæœ‰é—®é¢˜æ‰æœ‰è¾“å‡º
docker-compose restart   # é‡å¯æœåŠ¡
docker-compose start     # å¯åŠ¨æœåŠ¡
docker-compose stop      # åœæ­¢æœåŠ¡
```

## ä¸ƒã€Docker Composeé…ç½®å¸¸ç”¨å­—æ®µ

| **å­—æ®µ**       | **æè¿°**                                                     |
| -------------- | ------------------------------------------------------------ |
| build          | æŒ‡å®šDockerfileæ–‡ä»¶åï¼ˆè¦æŒ‡å®šçš„Dockerfileæ–‡ä»¶éœ€è¦åœ¨buildæ ‡ç­¾çš„å­çº§æ ‡ç­¾ä¸­ç”¨dockerfileæ ‡ç­¾æŒ‡å®šï¼‰ |
| dockerfile     | æ„å»ºé•œåƒä¸Šä¸‹æ–‡è·¯å¾„                                           |
| context        | å¯ä»¥æ˜¯dockerfileè·¯å¾„ï¼Œæˆ–è€…æ˜¯æ‰§è¡Œgit ä»“åº“çš„urlåœ°å€            |
| image          | æŒ‡å®šé•œåƒï¼ˆå·²å­˜åœ¨ï¼‰                                           |
| command        | æ‰§è¡Œå‘½ä»¤ï¼Œä¼šè¦†ç›–å®¹å™¨å¯åŠ¨åé»˜è®¤æ‰§è¡Œçš„å‘½ä»¤ï¼ˆä¼šè¦†ç›–Dockerfileçš„CMDæŒ‡ä»¤ï¼‰ |
| container_name | æŒ‡å®šå®¹å™¨åç§°ï¼Œç”±äºå®¹å™¨åç§°æ˜¯å”¯ä¸€çš„ï¼Œå¦‚æœæŒ‡å®šè‡ªå®šä¹‰åç§°ï¼Œåˆ™æ— æ³•scaleæŒ‡å®šå®¹å™¨æ•°é‡ |
| deploy         | æŒ‡å®šéƒ¨ç½²å’Œè¿è¡ŒæœåŠ¡ç›¸å…³é…ç½®ï¼Œåªèƒ½åœ¨Swarmæ¨¡å¼ä½¿ç”¨              |
| environment    | æ·»åŠ ç¯å¢ƒå˜é‡                                                 |
| networks       | åŠ å…¥ç½‘ç»œï¼Œå¼•ç”¨é¡¶çº§networksä¸‹æ¡ç›®                             |
| network-mode   | è®¾ç½®å®¹å™¨çš„ç½‘ç»œæ¨¡å¼                                           |
| ports          | æš´éœ²å®¹å™¨ç«¯å£ï¼Œä¸-p ç›¸åŒï¼Œä½†æ˜¯ç«¯å£ä¸èƒ½ä½äº60                  |
| volumes        | æŒ‚è½½ä¸€ä¸ªå®¿ä¸»æœºç›®å½•æˆ–å‘½ä»¤å·åˆ°å®¹å™¨ï¼Œå‘½åå·è¦åœ¨é¡¶çº§volumes å®šä¹‰å·åç§° |
| volumes_from   | ä»å¦ä¸€ä¸ªæœåŠ¡æˆ–å®¹å™¨æŒ‚è½½å·ï¼Œå¯é€‰å‚æ•° :ro å’Œ :rwï¼Œï¼ˆä»…ç‰ˆæœ¬â€˜2â€™æ”¯æŒï¼‰ |
| hostname       | åœ¨å®¹å™¨å†…è®¾ç½®å†…æ ¸å‚æ•°                                         |
| links          | è¿æ¥åˆ°å¦ä¸€ä¸ªå®¹å™¨ï¼Œ- æœåŠ¡åç§°[ : ]                            |
| privileged     | ç”¨æ¥ç»™å®¹å™¨rootæƒé™ï¼Œæ³¨æ„æ˜¯ä¸å®‰å…¨çš„ï¼Œtrue                     |
| restart        | é‡å¯ç­–ç•¥ï¼Œå®šä¹‰æ˜¯å¦é‡å¯å®¹å™¨ï¼›1.noï¼Œé»˜è®¤ç­–ç•¥ï¼Œåœ¨å®¹å™¨é€€å‡ºæ—¶ä¸é‡å¯å®¹å™¨ã€‚2.on-failureï¼Œåœ¨å®¹å™¨éæ­£å¸¸é€€å‡ºæ—¶ï¼ˆé€€å‡ºçŠ¶æ€é0ï¼‰ï¼Œæ‰ä¼šé‡å¯å®¹å™¨ã€‚3.on-failureï¼š3ï¼Œåœ¨å®¹å™¨éæ­£å¸¸é€€å‡ºæ—¶é‡å¯å®¹å™¨ï¼Œæœ€å¤šé‡å¯3æ¬¡ã€‚4.alwaysï¼Œåœ¨å®¹å™¨é€€å‡ºæ—¶æ€»æ˜¯é‡å¯å®¹å™¨ã€‚5.unless-stoppedï¼Œåœ¨å®¹å™¨é€€å‡ºæ—¶æ€»æ˜¯é‡å¯å®¹å™¨ï¼Œä½†æ˜¯ä¸è€ƒè™‘åœ¨Dockerå®ˆæŠ¤è¿›ç¨‹å¯åŠ¨æ—¶å°±å·²ç»åœæ­¢äº†çš„å®¹å™¨ã€‚ |
| depends_on     | æ­¤æ ‡ç­¾ç”¨äºè§£å†³å®¹å™¨çš„ä¾èµ–ï¼Œå¯åŠ¨å…ˆåé—®é¢˜ã€‚å¦‚å¯åŠ¨åº”ç”¨å®¹å™¨ï¼Œéœ€è¦å…ˆå¯åŠ¨æ•°æ®åº“å®¹å™¨php:depends_on:- apache- mysql |



## å…«ã€Composeç¼–æ’å¾®æœåŠ¡

### 1.æ”¹é€ å‡çº§å¾®æœåŠ¡å·¥ç¨‹docker_boot

01ã€ä»¥å‰çš„åŸºç¡€ç‰ˆ

![image-20230522181054358](./images/image-20230522181054358.png)

02ã€SQLå»ºåº“å»ºè¡¨

```sql
CREATE TABLE `t_user` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `username` varchar(50) NOT NULL DEFAULT '' COMMENT 'ç”¨æˆ·å',
  `password` varchar(50) NOT NULL DEFAULT '' COMMENT 'å¯†ç ',
  `sex` tinyint(4) NOT NULL DEFAULT '0' COMMENT 'æ€§åˆ« 0=å¥³ 1=ç”· ',
  `deleted` tinyint(4) unsigned NOT NULL DEFAULT '0' COMMENT 'åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤',
  `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8 COMMENT='ç”¨æˆ·è¡¨';
```

03ã€ä¸€é”®ç”Ÿæˆè¯´æ˜

04ã€æ”¹POM

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.5.6</version>
        <!--<version>2.3.10.RELEASE</version>-->
        <relativePath/> <!-- lookup parent from repository -->
    </parent>

    <groupId>com.atguigu.docker</groupId>
    <artifactId>docker_boot</artifactId>
    <version>0.0.1-SNAPSHOT</version>

    <properties>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <maven.compiler.source>1.8</maven.compiler.source>
        <maven.compiler.target>1.8</maven.compiler.target>
        <junit.version>4.12</junit.version>
        <log4j.version>1.2.17</log4j.version>
        <lombok.version>1.16.18</lombok.version>
        <mysql.version>5.1.47</mysql.version>
        <druid.version>1.1.16</druid.version>
        <mapper.version>4.1.5</mapper.version>
        <mybatis.spring.boot.version>1.3.0</mybatis.spring.boot.version>
    </properties>

    <dependencies>
        <!--guava Google å¼€æºçš„ Guava ä¸­è‡ªå¸¦çš„å¸ƒéš†è¿‡æ»¤å™¨-->
        <dependency>
            <groupId>com.google.guava</groupId>
            <artifactId>guava</artifactId>
            <version>23.0</version>
        </dependency>
        <!-- redisson -->
        <dependency>
            <groupId>org.redisson</groupId>
            <artifactId>redisson</artifactId>
            <version>3.13.4</version>
        </dependency>
        <!--SpringBooté€šç”¨ä¾èµ–æ¨¡å—-->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-actuator</artifactId>
        </dependency>
        <!--swagger2-->
        <dependency>
            <groupId>io.springfox</groupId>
            <artifactId>springfox-swagger2</artifactId>
            <version>2.9.2</version>
        </dependency>
        <dependency>
            <groupId>io.springfox</groupId>
            <artifactId>springfox-swagger-ui</artifactId>
            <version>2.9.2</version>
        </dependency>
        <!--SpringBootä¸Redisæ•´åˆä¾èµ–-->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-redis</artifactId>
        </dependency>
        <!--springCache-->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-cache</artifactId>
        </dependency>
        <!--springCacheè¿æ¥æ± ä¾èµ–åŒ…-->
        <dependency>
            <groupId>org.apache.commons</groupId>
            <artifactId>commons-pool2</artifactId>
        </dependency>
        <!-- jedis -->
        <dependency>
            <groupId>redis.clients</groupId>
            <artifactId>jedis</artifactId>
            <version>3.1.0</version>
        </dependency>
        <!--Mysqlæ•°æ®åº“é©±åŠ¨-->
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
            <version>5.1.47</version>
        </dependency>
        <!--SpringBooté›†æˆdruidè¿æ¥æ± -->
        <dependency>
            <groupId>com.alibaba</groupId>
            <artifactId>druid-spring-boot-starter</artifactId>
            <version>1.1.10</version>
        </dependency>
        <dependency>
            <groupId>com.alibaba</groupId>
            <artifactId>druid</artifactId>
            <version>${druid.version}</version>
        </dependency>
        <!--mybatiså’Œspringbootæ•´åˆ-->
        <dependency>
            <groupId>org.mybatis.spring.boot</groupId>
            <artifactId>mybatis-spring-boot-starter</artifactId>
            <version>${mybatis.spring.boot.version}</version>
        </dependency>
        <!-- æ·»åŠ springbootå¯¹amqpçš„æ”¯æŒ -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-amqp</artifactId>
        </dependency>
        <dependency>
            <groupId>commons-codec</groupId>
            <artifactId>commons-codec</artifactId>
            <version>1.10</version>
        </dependency>
        <!--é€šç”¨åŸºç¡€é…ç½®junit/devtools/test/log4j/lombok/hutool-->
        <!--hutool-->
        <dependency>
            <groupId>cn.hutool</groupId>
            <artifactId>hutool-all</artifactId>
            <version>5.2.3</version>
        </dependency>
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <version>${junit.version}</version>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-devtools</artifactId>
            <scope>runtime</scope>
            <optional>true</optional>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>log4j</groupId>
            <artifactId>log4j</artifactId>
            <version>${log4j.version}</version>
        </dependency>
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <version>${lombok.version}</version>
            <optional>true</optional>
        </dependency>
        <!--persistence-->
        <dependency>
            <groupId>javax.persistence</groupId>
            <artifactId>persistence-api</artifactId>
            <version>1.0.2</version>
        </dependency>
        <!--é€šç”¨Mapper-->
        <dependency>
            <groupId>tk.mybatis</groupId>
            <artifactId>mapper</artifactId>
            <version>${mapper.version}</version>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-resources-plugin</artifactId>
                <version>3.1.0</version>
            </plugin>
        </plugins>
    </build>

</project>
```

05ã€å†™YML

```properties
server.port=6001
# ========================alibaba.druidç›¸å…³é…ç½®=====================
spring.datasource.type=com.alibaba.druid.pool.DruidDataSource
spring.datasource.driver-class-name=com.mysql.jdbc.Driver
spring.datasource.url=jdbc:mysql://192.168.111.169:3306/db2021?useUnicode=true&characterEncoding=utf-8&useSSL=false
spring.datasource.username=root
spring.datasource.password=123456
spring.datasource.druid.test-while-idle=false
# ========================redisç›¸å…³é…ç½®=====================
spring.redis.database=0
spring.redis.host=192.168.111.169
spring.redis.port=6379
spring.redis.password=
spring.redis.lettuce.pool.max-active=8
spring.redis.lettuce.pool.max-wait=-1ms
spring.redis.lettuce.pool.max-idle=8
spring.redis.lettuce.pool.min-idle=0
# ========================mybatisç›¸å…³é…ç½®===================
mybatis.mapper-locations=classpath:mapper/*.xml
mybatis.type-aliases-package=com.atguigu.docker.entities
# ========================swagger=====================
spring.swagger2.enabled=true
```

06ã€ä¸»å¯åŠ¨

```java
package com.atguigu.docker;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import tk.mybatis.spring.annotation.MapperScan;

@SpringBootApplication
@MapperScan("com.atguigu.docker.mapper") //import tk.mybatis.spring.annotation.MapperScan;
public class DockerBootApplication
{
    public static void main(String[] args)
    {
        SpringApplication.run(DockerBootApplication.class, args);
    }
}
```

07ã€ä¸šåŠ¡ç±»

>   configé…ç½®ç±»

RedisConfig

```java
package com.atguigu.docker.config;

import lombok.extern.slf4j.Slf4j;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.data.redis.serializer.GenericJackson2JsonRedisSerializer;
import org.springframework.data.redis.serializer.StringRedisSerializer;

import java.io.Serializable;

/**
 * @auther zzyy
 * @create 2021-10-27 17:19
 */

@Configuration
@Slf4j
public class RedisConfig
{
    /**
     * @param lettuceConnectionFactory
     * @return
     *
     * redisåºåˆ—åŒ–çš„å·¥å…·é…ç½®ç±»ï¼Œä¸‹é¢è¿™ä¸ªè¯·ä¸€å®šå¼€å¯é…ç½®
     * 127.0.0.1:6379> keys *
     * 1) "ord:102"  åºåˆ—åŒ–è¿‡
     * 2) "\xac\xed\x00\x05t\x00\aord:102"   é‡ç”Ÿï¼Œæ²¡æœ‰åºåˆ—åŒ–è¿‡
     */
    @Bean
    public RedisTemplate<String,Serializable> redisTemplate(LettuceConnectionFactory lettuceConnectionFactory)
    {
        RedisTemplate<String,Serializable> redisTemplate = new RedisTemplate<>();

        redisTemplate.setConnectionFactory(lettuceConnectionFactory);
        //è®¾ç½®keyåºåˆ—åŒ–æ–¹å¼string
        redisTemplate.setKeySerializer(new StringRedisSerializer());
        //è®¾ç½®valueçš„åºåˆ—åŒ–æ–¹å¼json
        redisTemplate.setValueSerializer(new GenericJackson2JsonRedisSerializer());

        redisTemplate.setHashKeySerializer(new StringRedisSerializer());
        redisTemplate.setHashValueSerializer(new GenericJackson2JsonRedisSerializer());

        redisTemplate.afterPropertiesSet();

        return redisTemplate;
    }
}
```

SwaggerConfig

```java
package com.atguigu.docker.config;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import springfox.documentation.builders.ApiInfoBuilder;
import springfox.documentation.builders.PathSelectors;
import springfox.documentation.builders.RequestHandlerSelectors;
import springfox.documentation.service.ApiInfo;
import springfox.documentation.spi.DocumentationType;
import springfox.documentation.spring.web.plugins.Docket;
import springfox.documentation.swagger2.annotations.EnableSwagger2;

import java.text.SimpleDateFormat;
import java.util.Date;

/**
 * @auther zzyy
 * @create 2021-05-01 16:18
 */
@Configuration
@EnableSwagger2
public class SwaggerConfig
{
    @Value("${spring.swagger2.enabled}")
    private Boolean enabled;

    @Bean
    public Docket createRestApi() {
        return new Docket(DocumentationType.SWAGGER_2)
                .apiInfo(apiInfo())
                .enable(enabled)
                .select()
                .apis(RequestHandlerSelectors.basePackage("com.atguigu.docker")) //ä½ è‡ªå·±çš„package
                .paths(PathSelectors.any())
                .build();
    }

    public ApiInfo apiInfo() {
        return new ApiInfoBuilder()
                .title("å°šç¡…è°·Javaå¤§å‚æŠ€æœ¯"+"\t"+new SimpleDateFormat("yyyy-MM-dd").format(new Date()))
                .description("docker-compose")
                .version("1.0")
                .termsOfServiceUrl("https://www.atguigu.com/")
                .build();
    }
}
```

>   æ–°å»ºentity

User

```java
package com.atguigu.docker.entities;

import javax.persistence.Column;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;
import javax.persistence.Table;
import java.util.Date;

@Table(name = "t_user")
public class User
{
    @Id
    @GeneratedValue(generator = "JDBC")
    private Integer id;

    /**
     * ç”¨æˆ·å
     */
    private String username;

    /**
     * å¯†ç 
     */
    private String password;

    /**
     * æ€§åˆ« 0=å¥³ 1=ç”· 
     */
    private Byte sex;

    /**
     * åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤
     */
    private Byte deleted;

    /**
     * æ›´æ–°æ—¶é—´
     */
    @Column(name = "update_time")
    private Date updateTime;

    /**
     * åˆ›å»ºæ—¶é—´
     */
    @Column(name = "create_time")
    private Date createTime;

    /**
     * @return id
     */
    public Integer getId() {
        return id;
    }

    /**
     * @param id
     */
    public void setId(Integer id) {
        this.id = id;
    }

    /**
     * è·å–ç”¨æˆ·å
     *
     * @return username - ç”¨æˆ·å
     */
    public String getUsername() {
        return username;
    }

    /**
     * è®¾ç½®ç”¨æˆ·å
     *
     * @param username ç”¨æˆ·å
     */
    public void setUsername(String username) {
        this.username = username;
    }

    /**
     * è·å–å¯†ç 
     *
     * @return password - å¯†ç 
     */
    public String getPassword() {
        return password;
    }

    /**
     * è®¾ç½®å¯†ç 
     *
     * @param password å¯†ç 
     */
    public void setPassword(String password) {
        this.password = password;
    }

    /**
     * è·å–æ€§åˆ« 0=å¥³ 1=ç”· 
     *
     * @return sex - æ€§åˆ« 0=å¥³ 1=ç”· 
     */
    public Byte getSex() {
        return sex;
    }

    /**
     * è®¾ç½®æ€§åˆ« 0=å¥³ 1=ç”· 
     *
     * @param sex æ€§åˆ« 0=å¥³ 1=ç”· 
     */
    public void setSex(Byte sex) {
        this.sex = sex;
    }

    /**
     * è·å–åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤
     *
     * @return deleted - åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤
     */
    public Byte getDeleted() {
        return deleted;
    }

    /**
     * è®¾ç½®åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤
     *
     * @param deleted åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤
     */
    public void setDeleted(Byte deleted) {
        this.deleted = deleted;
    }

    /**
     * è·å–æ›´æ–°æ—¶é—´
     *
     * @return update_time - æ›´æ–°æ—¶é—´
     */
    public Date getUpdateTime() {
        return updateTime;
    }

    /**
     * è®¾ç½®æ›´æ–°æ—¶é—´
     *
     * @param updateTime æ›´æ–°æ—¶é—´
     */
    public void setUpdateTime(Date updateTime) {
        this.updateTime = updateTime;
    }

    /**
     * è·å–åˆ›å»ºæ—¶é—´
     *
     * @return create_time - åˆ›å»ºæ—¶é—´
     */
    public Date getCreateTime() {
        return createTime;
    }

    /**
     * è®¾ç½®åˆ›å»ºæ—¶é—´
     *
     * @param createTime åˆ›å»ºæ—¶é—´
     */
    public void setCreateTime(Date createTime) {
        this.createTime = createTime;
    }
}
```

UserDTO

```java
package com.atguigu.docker.entities;

import io.swagger.annotations.ApiModel;
import io.swagger.annotations.ApiModelProperty;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.io.Serializable;
import java.util.Date;

@NoArgsConstructor
@AllArgsConstructor
@Data
@ApiModel(value = "ç”¨æˆ·ä¿¡æ¯")
public class UserDTO implements Serializable
{
    @ApiModelProperty(value = "ç”¨æˆ·ID")
    private Integer id;

    @ApiModelProperty(value = "ç”¨æˆ·å")
    private String username;

    @ApiModelProperty(value = "å¯†ç ")
    private String password;

    @ApiModelProperty(value = "æ€§åˆ« 0=å¥³ 1=ç”· ")
    private Byte sex;

    @ApiModelProperty(value = "åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤")
    private Byte deleted;

    @ApiModelProperty(value = "æ›´æ–°æ—¶é—´")
    private Date updateTime;

    @ApiModelProperty(value = "åˆ›å»ºæ—¶é—´")
    private Date createTime;

    /**
     * @return id
     */
    public Integer getId() {
        return id;
    }

    /**
     * @param id
     */
    public void setId(Integer id) {
        this.id = id;
    }

    /**
     * è·å–ç”¨æˆ·å
     *
     * @return username - ç”¨æˆ·å
     */
    public String getUsername() {
        return username;
    }

    /**
     * è®¾ç½®ç”¨æˆ·å
     *
     * @param username ç”¨æˆ·å
     */
    public void setUsername(String username) {
        this.username = username;
    }

    /**
     * è·å–å¯†ç 
     *
     * @return password - å¯†ç 
     */
    public String getPassword() {
        return password;
    }

    /**
     * è®¾ç½®å¯†ç 
     *
     * @param password å¯†ç 
     */
    public void setPassword(String password) {
        this.password = password;
    }

    /**
     * è·å–æ€§åˆ« 0=å¥³ 1=ç”· 
     *
     * @return sex - æ€§åˆ« 0=å¥³ 1=ç”· 
     */
    public Byte getSex() {
        return sex;
    }

    /**
     * è®¾ç½®æ€§åˆ« 0=å¥³ 1=ç”· 
     *
     * @param sex æ€§åˆ« 0=å¥³ 1=ç”· 
     */
    public void setSex(Byte sex) {
        this.sex = sex;
    }

    /**
     * è·å–åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤
     *
     * @return deleted - åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤
     */
    public Byte getDeleted() {
        return deleted;
    }

    /**
     * è®¾ç½®åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤
     *
     * @param deleted åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤
     */
    public void setDeleted(Byte deleted) {
        this.deleted = deleted;
    }

    /**
     * è·å–æ›´æ–°æ—¶é—´
     *
     * @return update_time - æ›´æ–°æ—¶é—´
     */
    public Date getUpdateTime() {
        return updateTime;
    }

    /**
     * è®¾ç½®æ›´æ–°æ—¶é—´
     *
     * @param updateTime æ›´æ–°æ—¶é—´
     */
    public void setUpdateTime(Date updateTime) {
        this.updateTime = updateTime;
    }

    /**
     * è·å–åˆ›å»ºæ—¶é—´
     *
     * @return create_time - åˆ›å»ºæ—¶é—´
     */
    public Date getCreateTime() {
        return createTime;
    }

    /**
     * è®¾ç½®åˆ›å»ºæ—¶é—´
     *
     * @param createTime åˆ›å»ºæ—¶é—´
     */
    public void setCreateTime(Date createTime) {
        this.createTime = createTime;
    }

    @Override
    public String toString() {
        return "User{" +
                "id=" + id +
                ", username='" + username + '\'' +
                ", password='" + password + '\'' +
                ", sex=" + sex +
                '}';
    }
}
```

>   æ–°å»ºmapper

æ–°å»ºæ¥å£UserMapper

```java
package com.atguigu.docker.mapper;

import com.atguigu.docker.entities.User;
import tk.mybatis.mapper.common.Mapper;

public interface UserMapper extends Mapper<User> {
}
```

src/main/resourcesè·¯å¾„ä¸‹æ–°å»ºmapperæ–‡ä»¶å¤¹å¹¶æ–°å¢UserMapper.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.atguigu.docker.mapper.UserMapper">
  <resultMap id="BaseResultMap" type="com.atguigu.docker.entities.User">
    <!--
      WARNING - @mbg.generated
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="username" jdbcType="VARCHAR" property="username" />
    <result column="password" jdbcType="VARCHAR" property="password" />
    <result column="sex" jdbcType="TINYINT" property="sex" />
    <result column="deleted" jdbcType="TINYINT" property="deleted" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
  </resultMap>
</mapper>
```

>   æ–°å»ºService

```java
package com.atguigu.docker.service;

import com.atguigu.docker.entities.User;
import com.atguigu.docker.mapper.UserMapper;
import lombok.extern.slf4j.Slf4j;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.data.redis.core.ValueOperations;
import org.springframework.stereotype.Service;
import org.springframework.web.bind.annotation.PathVariable;

import javax.annotation.Resource;
import java.util.concurrent.TimeUnit;

/**
 * @auther zzyy
 * @create 2021-05-01 14:58
 */
@Service
@Slf4j
public class UserService {

    public static final String CACHE_KEY_USER = "user:";

    @Resource
    private UserMapper userMapper;
    @Resource
    private RedisTemplate redisTemplate;

    /**
     * addUser
     * @param user
     */
    public void addUser(User user)
    {
        //1 å…ˆæ’å…¥mysqlå¹¶æˆåŠŸ
        int i = userMapper.insertSelective(user);

        if(i > 0)
        {
            //2 éœ€è¦å†æ¬¡æŸ¥è¯¢ä¸€ä¸‹mysqlå°†æ•°æ®æå›æ¥å¹¶ok
            user = userMapper.selectByPrimaryKey(user.getId());
            //3 å°†æå‡ºæ¥çš„userå­˜è¿›redisï¼Œå®Œæˆæ–°å¢åŠŸèƒ½çš„æ•°æ®ä¸€è‡´æ€§ã€‚
            String key = CACHE_KEY_USER+user.getId();
            redisTemplate.opsForValue().set(key,user);
        }
    }

    /**
     * findUserById
     * @param id
     * @return
     */
    public User findUserById(Integer id)
    {
        User user = null;
        String key = CACHE_KEY_USER+id;

        //1 å…ˆä»redisé‡Œé¢æŸ¥è¯¢ï¼Œå¦‚æœæœ‰ç›´æ¥è¿”å›ç»“æœï¼Œå¦‚æœæ²¡æœ‰å†å»æŸ¥è¯¢mysql
        user = (User) redisTemplate.opsForValue().get(key);

        if(user == null)
        {
            //2 redisé‡Œé¢æ— ï¼Œç»§ç»­æŸ¥è¯¢mysql
            user = userMapper.selectByPrimaryKey(id);
            if(user == null)
            {
                //3.1 redis+mysql éƒ½æ— æ•°æ®
                //ä½ å…·ä½“ç»†åŒ–ï¼Œé˜²æ­¢å¤šæ¬¡ç©¿é€ï¼Œæˆ‘ä»¬è§„å®šï¼Œè®°å½•ä¸‹å¯¼è‡´ç©¿é€çš„è¿™ä¸ªkeyå›å†™redis
                return user;
            }else{
                //3.2 mysqlæœ‰ï¼Œéœ€è¦å°†æ•°æ®å†™å›redisï¼Œä¿è¯ä¸‹ä¸€æ¬¡çš„ç¼“å­˜å‘½ä¸­ç‡
                redisTemplate.opsForValue().set(key,user);
            }
        }
        return user;
    }
}
```

>   æ–°å»ºController

```java
package com.atguigu.docker.controller;

import cn.hutool.core.util.IdUtil;
import cn.hutool.core.util.ReferenceUtil;
import com.atguigu.docker.entities.User;
import com.atguigu.docker.entities.UserDTO;
import com.atguigu.docker.service.UserService;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import io.swagger.models.auth.In;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.BeanUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import javax.annotation.Resource;
import java.util.Random;

/**
 * @auther zzyy
 * @create 2021-05-01 15:02
 */
@Api(description = "ç”¨æˆ·Useræ¥å£")
@RestController
@Slf4j
public class UserController
{
    @Resource
    private UserService userService;

    @ApiOperation("æ•°æ®åº“æ–°å¢3æ¡è®°å½•")
    @RequestMapping(value = "/user/add",method = RequestMethod.POST)
    public void addUser()
    {
        for (int i = 1; i <=3; i++) {
            User user = new User();

            user.setUsername("zzyy"+i);
            user.setPassword(IdUtil.simpleUUID().substring(0,6));
            user.setSex((byte) new Random().nextInt(2));

            userService.addUser(user);
        }
    }

    @ApiOperation("åˆ é™¤1æ¡è®°å½•")
    @RequestMapping(value = "/user/delete/{id}",method = RequestMethod.POST)
    public void deleteUser(@PathVariable Integer id)
    {
        userService.deleteUser(id);
    }

    @ApiOperation("ä¿®æ”¹1æ¡è®°å½•")
    @RequestMapping(value = "/user/update",method = RequestMethod.POST)
    public void updateUser(@RequestBody UserDTO userDTO)
    {
        User user = new User();
        BeanUtils.copyProperties(userDTO,user);
        userService.updateUser(user);
    }

    @ApiOperation("æŸ¥è¯¢1æ¡è®°å½•")
    @RequestMapping(value = "/user/find/{id}",method = RequestMethod.GET)
    public User findUserById(@PathVariable Integer id)
    {
        return userService.findUserById2(id);
    }
}
```

08ã€mvn package å‘½ä»¤å°†å¾®æœåŠ¡å½¢æˆæ–°çš„jaråŒ…ï¼Œå¹¶ä¸Šä¼ å¸¦LinuxæœåŠ¡å™¨/mydockerç›®å½•ä¸‹

09ã€ç¼–å†™Dockerfile

```dockerfile
# åŸºç¡€é•œåƒä½¿ç”¨java
FROM java:8
# ä½œè€…
MAINTAINER zzyy
# VOLUME æŒ‡å®šä¸´æ—¶æ–‡ä»¶ç›®å½•ä¸º/tmpï¼Œåœ¨ä¸»æœº/var/lib/dockerç›®å½•ä¸‹åˆ›å»ºäº†ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶å¹¶é“¾æ¥åˆ°å®¹å™¨çš„/tmp
VOLUME /tmp
# å°†jaråŒ…æ·»åŠ åˆ°å®¹å™¨ä¸­å¹¶æ›´åä¸ºzzyy_docker.jar
ADD docker_boot-0.0.1-SNAPSHOT.jar zzyy_docker.jar
# è¿è¡ŒjaråŒ…
RUN bash -c 'touch /zzyy_docker.jar'
ENTRYPOINT ["java","-jar","/zzyy_docker.jar"]
#æš´éœ²6001ç«¯å£ä½œä¸ºå¾®æœåŠ¡
EXPOSE 6001
```

10ã€æ„å»ºé•œåƒ

```shell
docker build -t zzyy_docker:1.6 .
```

### 2.ä¸ç”¨ComposeâŒ

>   å•ç‹¬çš„mysqlå®¹å™¨å®ä¾‹

æ–°å»ºmysqlå®¹å™¨å®ä¾‹

```shell
docker run -p 3306:3306 --name mysql57 --privileged=true -v /zzyyuse/mysql/conf:/etc/mysql/conf.d -v /zzyyuse/mysql/logs:/logs -v /zzyyuse/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7
```

è¿›å…¥myslå®¹å™¨å®ä¾‹å¹¶æ–°å»ºåº“db2021+æ–°å»ºè¡¨t_user

```shell
docker exec -it mysql57 /bin/bash
```

```sql
mysql -uroot -p123456

create database db2021;

use db2021;

CREATE TABLE `t_user` (
  `id` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
  `username` VARCHAR(50) NOT NULL DEFAULT '' COMMENT 'ç”¨æˆ·å',
  `password` VARCHAR(50) NOT NULL DEFAULT '' COMMENT 'å¯†ç ',
  `sex` TINYINT(4) NOT NULL DEFAULT '0' COMMENT 'æ€§åˆ« 0=å¥³ 1=ç”· ',
  `deleted` TINYINT(4) UNSIGNED NOT NULL DEFAULT '0' COMMENT 'åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤',
  `update_time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  `create_time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  PRIMARY KEY (`id`)
) ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è¡¨';
```

>   å•ç‹¬çš„rediså®¹å™¨å®ä¾‹

```shell
docker run  -p 6379:6379 --name redis608 --privileged=true -v /app/redis/redis.conf:/etc/redis/redis.conf -v /app/redis/data:/data -d redis:6.0.8 redis-server /etc/redis/redis.conf
```

>   å¾®æœåŠ¡å·¥ç¨‹

```shell
 docker run -d -p 6001:6001 zzyy_docker:1.6
```

>   ä¸Šé¢ä¸‰ä¸ªå®¹å™¨å®ä¾‹ä¾æ¬¡å¯åŠ¨æˆåŠŸ

![image-20230522182207681](./images/image-20230522182207681.png)

### 3.swaggeræµ‹è¯•

```http
http://localhost:ä½ çš„å¾®æœåŠ¡ç«¯å£/swagger-ui.html#/
```

### 4.ä¸Šé¢æˆåŠŸäº†ï¼Œæœ‰å“ªäº›é—®é¢˜ï¼Ÿ

1.  å…ˆåé¡ºåºè¦æ±‚å›ºå®šï¼Œå…ˆmysql+redisæ‰èƒ½å¾®æœåŠ¡è®¿é—®æˆåŠŸ
2.  å¤šä¸ªrunå‘½ä»¤â€¦â€¦
3.  å®¹å™¨é—´çš„å¯åœæˆ–è€…å®•æœºï¼Œæœ‰å¯èƒ½å¯¼è‡´IPåœ°å€å¯¹åº”çš„å®¹å™¨å®ä¾‹å˜åŒ–ï¼Œæ˜ å°„å‡ºé”™ï¼Œè¦ä¹ˆç”Ÿäº§IPå†™æ­»ï¼ˆè™½ç„¶å¯ä»¥ä½†æ˜¯ä¸æ¨èï¼‰ï¼Œè¦ä¹ˆé€šè¿‡æœåŠ¡è°ƒç”¨

### 5.ä½¿ç”¨Compose

1.  æœåŠ¡ç¼–æ’ï¼Œä¸€å¥—å¸¦èµ°ï¼Œå®‰æ’
2.  ç¼–å†™docker-compose.ymlæ–‡ä»¶

```yml
version: "3"

services:
  microService:
    image: zzyy_docker:1.6
    container_name: ms01
    ports:
      - "6001:6001"
    volumes:
      - /app/microService:/data
    networks:
      - atguigu_net 
    depends_on: 
      - redis
      - mysql

  redis:
    image: redis:6.0.8
    ports:
      - "6379:6379"
    volumes:
      - /app/redis/redis.conf:/etc/redis/redis.conf
      - /app/redis/data:/data
    networks: 
      - atguigu_net
    command: redis-server /etc/redis/redis.conf

  mysql:
    image: mysql:5.7
    environment:
      MYSQL_ROOT_PASSWORD: '123456'
      MYSQL_ALLOW_EMPTY_PASSWORD: 'no'
      MYSQL_DATABASE: 'db2021'
      MYSQL_USER: 'zzyy'
      MYSQL_PASSWORD: 'zzyy123'
    ports:
       - "3306:3306"
    volumes:
       - /app/mysql/db:/var/lib/mysql
       - /app/mysql/conf/my.cnf:/etc/my.cnf
       - /app/mysql/init:/docker-entrypoint-initdb.d
    networks:
      - atguigu_net
    command: --default-authentication-plugin=mysql_native_password #è§£å†³å¤–éƒ¨æ— æ³•è®¿é—®
 
networks: 
   atguigu_net: 
```

3.   ç¬¬äºŒæ¬¡ä¿®æ”¹å¾®æœåŠ¡å·¥ç¨‹docker_boot

å†™YML

```properties
server.port=6001

# ========================alibaba.druidç›¸å…³é…ç½®=====================
spring.datasource.type=com.alibaba.druid.pool.DruidDataSource
spring.datasource.driver-class-name=com.mysql.jdbc.Driver
#spring.datasource.url=jdbc:mysql://192.168.111.169:3306/db2021?useUnicode=true&characterEncoding=utf-8&useSSL=false
spring.datasource.url=jdbc:mysql://mysql:3306/db2021?useUnicode=true&characterEncoding=utf-8&useSSL=false
spring.datasource.username=root
spring.datasource.password=123456
spring.datasource.druid.test-while-idle=false

# ========================redisç›¸å…³é…ç½®=====================
spring.redis.database=0
#spring.redis.host=192.168.111.169
spring.redis.host=redis
spring.redis.port=6379
spring.redis.password=
spring.redis.lettuce.pool.max-active=8
spring.redis.lettuce.pool.max-wait=-1ms
spring.redis.lettuce.pool.max-idle=8
spring.redis.lettuce.pool.min-idle=0

# ========================mybatisç›¸å…³é…ç½®===================
mybatis.mapper-locations=classpath:mapper/*.xml
mybatis.type-aliases-package=com.atguigu.docker.entities

# ========================swagger=====================
spring.swagger2.enabled=true
```

é€šè¿‡æœåŠ¡åè®¿é—®ï¼ŒIPæ— å…³

mvn packageå‘½ä»¤æ™¶å¾®æœåŠ¡å½¢æˆæ–°çš„jaråŒ…ï¼Œå¹¶ä¸Šä¼ åˆ°LinuxæœåŠ¡å™¨/mydockerç›®å½•ä¸‹

ç¼–å†™Dockerfile

```dockerfile
# åŸºç¡€é•œåƒä½¿ç”¨java
FROM java:8
# ä½œè€…
MAINTAINER zzyy
# VOLUME æŒ‡å®šä¸´æ—¶æ–‡ä»¶ç›®å½•ä¸º/tmpï¼Œåœ¨ä¸»æœº/var/lib/dockerç›®å½•ä¸‹åˆ›å»ºäº†ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶å¹¶é“¾æ¥åˆ°å®¹å™¨çš„/tmp
VOLUME /tmp
# å°†jaråŒ…æ·»åŠ åˆ°å®¹å™¨ä¸­å¹¶æ›´åä¸ºzzyy_docker.jar
ADD docker_boot-0.0.1-SNAPSHOT.jar zzyy_docker.jar
# è¿è¡ŒjaråŒ…
RUN bash -c 'touch /zzyy_docker.jar'
ENTRYPOINT ["java","-jar","/zzyy_docker.jar"]
#æš´éœ²6001ç«¯å£ä½œä¸ºå¾®æœåŠ¡
EXPOSE 6001
```

æ„å»ºé•œåƒ

```shell
docker build -t zzyy_boot:1.6 .
```

4.   æ‰§è¡Œdocker-compose upæˆ–è€…docker-compose up -d

```shell
# ä¸¤ä¸ªé€‰æ‹©ä¸€ä¸ªæ‰§è¡Œå³å¯ï¼
docker-compose up
docker-compose up -d
```

![image-20230522183154214](./images/image-20230522183154214.png)

![image-20230522183201379](./images/image-20230522183201379.png)

5.   è¿›å…¥mysqlå®¹å™¨å®ä¾‹å¹¶æ–°å»ºåº“db2021+æ–°å»ºè¡¨t_user

```shell
docker exec -it å®¹å™¨å®ä¾‹id /bin/bash
```

```sql
mysql -uroot -p123456

create database db2021;

use db2021;

CREATE TABLE `t_user` (
  `id` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
  `username` VARCHAR(50) NOT NULL DEFAULT '' COMMENT 'ç”¨æˆ·å',
  `password` VARCHAR(50) NOT NULL DEFAULT '' COMMENT 'å¯†ç ',
  `sex` TINYINT(4) NOT NULL DEFAULT '0' COMMENT 'æ€§åˆ« 0=å¥³ 1=ç”· ',
  `deleted` TINYINT(4) UNSIGNED NOT NULL DEFAULT '0' COMMENT 'åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤',
  `update_time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  `create_time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  PRIMARY KEY (`id`)
) ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è¡¨';
```

6.   æµ‹è¯•é€šè¿‡

7.   Composeå¸¸ç”¨å‘½ä»¤

```shell
# Composeå¸¸ç”¨å‘½ä»¤
docker-compose -h                           # æŸ¥çœ‹å¸®åŠ©
docker-compose up                           # å¯åŠ¨æ‰€æœ‰docker-composeæœåŠ¡
docker-compose up -d                        # å¯åŠ¨æ‰€æœ‰docker-composeæœåŠ¡å¹¶åå°è¿è¡Œ
docker-compose down                         # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ã€ç½‘ç»œã€å·ã€é•œåƒã€‚
docker-compose exec  ymlé‡Œé¢çš„æœåŠ¡id                 # è¿›å…¥å®¹å™¨å®ä¾‹å†…éƒ¨  docker-compose exec docker-compose.ymlæ–‡ä»¶ä¸­å†™çš„æœåŠ¡id /bin/bash
docker-compose ps                      # å±•ç¤ºå½“å‰docker-composeç¼–æ’è¿‡çš„è¿è¡Œçš„æ‰€æœ‰å®¹å™¨
docker-compose top                     # å±•ç¤ºå½“å‰docker-composeç¼–æ’è¿‡çš„å®¹å™¨è¿›ç¨‹

docker-compose logs  ymlé‡Œé¢çš„æœåŠ¡id     # æŸ¥çœ‹å®¹å™¨è¾“å‡ºæ—¥å¿—
dokcer-compose config     # æ£€æŸ¥é…ç½®
dokcer-compose config -q  # æ£€æŸ¥é…ç½®ï¼Œæœ‰é—®é¢˜æ‰æœ‰è¾“å‡º
docker-compose restart   # é‡å¯æœåŠ¡
docker-compose start     # å¯åŠ¨æœåŠ¡
docker-compose stop      # åœæ­¢æœåŠ¡
```

8.   å…³åœ

```shell
docker-compose stop
```

![image-20230522183514316](./images/image-20230522183514316.png)

>   ğŸ“šæ‹“å±•çŸ¥è¯†ç‚¹ï¼š
>
>   [dockerã€docker-composeæ­å»ºrediså“¨å…µï¼Œé›†ç¾¤ã€‚](https://blog.csdn.net/qq_49059667/article/details/123987075)

